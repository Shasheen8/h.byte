---
title: The Cyberhaven Chrome Extension Vulnerability
date: Mon, 06 Jan 2025 08:00:00 +0000
---

In late December 2024, **Cyberhaven**, a *data loss prevention company*, experienced a *security breach* involving its *Chrome browser extension*. The incident was part of a broader campaign targeting *multiple Chrome extensions* across various organizations.

## Incident Overview

On *December 24, 2024*, a Cyberhaven employee fell victim to a *phishing attack* that compromised their *Google Chrome Web Store access*. The attacker exploited this access to publish a *malicious version* (24.10.4) of Cyberhaven’s Chrome extension. This compromised extension was active from *December 25, 1:32 AM UTC*, until *December 26, 2:50 AM UTC*, during which it could *exfiltrate sensitive user data*, including *authenticated sessions* and *cookies*, to a rogue domain (*cyberhavenext[.]pro*).

### Malicious Components
The malicious extension contained two altered *JavaScript files*:

- **worker.js**:
    - Contacted the *command and control (C&C) server* at *cyberhavenext[.]pro* to download a *configuration* stored in Chrome’s *local storage*.
    - Registered *listeners* to handle events from *content.js* and execute *HTTP requests* as directed.
- **content.js**:
    - Monitored *user interactions* and *DOM changes*, focusing on specific *websites*.
    - Communicated with *worker.js* to relay information back to the attacker, facilitating the *exfiltration* of sensitive data.

> **Key Risk**: The compromised extension could steal sensitive data from users visiting targeted websites.

## Attack Vector

The attack vector involved a *phishing email* that led the employee to authorize a malicious *OAuth application* named “*Privacy Policy Extension*.” This authorization allowed the attacker to *upload* the compromised extension to the *Chrome Web Store*.

- **Security Bypass**: Notably, the employee had *Google Advanced Protection* and *multi-factor authentication (MFA)* enabled yet did not receive an *MFA prompt* during the attack, indicating a *sophisticated bypass* of security measures.
- **Impact**: The attacker gained unauthorized access to publish the malicious version (24.10.4).

> **Key Insight**: Advanced phishing can bypass even robust security measures like MFA.

## Community Insights

Additional details were shared by security researchers on X after reaching out to Cyberhaven:

- **solst/ICE (@IceSolst)**, December 26, 2024:
  > Some extra details we got from Cyberhaven (only after reaching out to them) cc @tuckner on the config keys below The extension (version 24.10.6) is currently pending review by Google and will be ready to push in the next few hours We intend to push the update to the Chrome…
- **tuckner (@tuckner)**, December 26, 2024:
  > CyberHaven malicious extension (24.10.4) details 🧵 A new content script was added to the extension manifest which runs at the start of every webpage [image attachment]

> **Pro Tip**: Engage with security communities on X for real-time incident updates.

## Post-Incident Analysis and Remediation

The incident highlighted two scenarios for managing such attacks, depending on whether the extension is controlled via *browser security* or *mobile device management (MDM)*.

### Scenario 1: Extension Controlled Using Browser Security on Chrome
#### Challenges
- *Limited control* over extension behavior.
- *Dependency* on Chrome’s built-in *extension management policies* for mitigation.
- Users may *unwittingly install* the malicious extension if not preemptively blocked.

#### Actions for Security Teams
1. **Analyze and Block the Extension**:
    - **Audit Installed Extensions**: Use tools like *Chrome Browser Cloud Management (CBCM)* to generate an *inventory* of extensions across managed endpoints.
    - **Create an Extension Blocklist**: Block the malicious extension by its *unique extension ID* using Chrome policies:
        ```json
        {
            "ExtensionSettings": {
                "*": {
                    "installation_mode": "allowed"
                },
                "malicious_extension_id": {
                    "installation_mode": "blocked"
                }
            }
        }
        ```
    - **Force Removal**: Enforce a policy to *uninstall* the extension from all managed browsers.

2. **Enhance User Awareness**:
    - Notify users about the *malicious extension* and provide steps to *verify its presence* and *remove* it if necessary.
    - *Rotate user credentials* for necessary applications.
    - Educate users on spotting *potentially malicious extensions* and encourage the use of *vetted tools*.

3. **Monitor Browser Activity**:
    - **DNS and Network Traffic**: Monitor for communication to *suspicious domains* associated with the extension.
    - **Anomaly Detection**: Look for *unusual browser behaviors*, such as *excessive CPU usage* or *unexpected web requests* originating from endpoints.

4. **Restrict Extension Permissions**:
    - Implement *strict permissions policies* for Chrome extensions, allowing only those necessary for *legitimate business purposes*.
    - Use *enterprise extension allowlisting* to preapprove a set of *trusted extensions*.

> **Key Consideration**: Proactive extension management prevents unauthorized installations.

### Scenario 2: Extension Controlled via MDM with No Log Visibility
#### Challenges
- *Complete control* by the *third-party provider* means *no transparency* in operations.
- *Logs* and *telemetry* are unavailable for *real-time monitoring* or *incident response*.
- Mitigation requires *third-party coordination*.

#### Actions for Security Teams
1. **Evaluate the Third-Party Vendor**:
    - **Demand Transparency**: Request *detailed reports* and *security assessments*, including evidence of a *secure software development lifecycle (SDLC)*.
    - **Review Incident Response Plans**: Ensure the vendor has *robust incident handling mechanisms*.
    - **Compliance Checks**: Verify adherence to *security frameworks* (e.g., *SOC 2*, *ISO 27001*).

2. **Control Distribution and Use**:
    - **Restrict to Necessary Systems**: Deploy the extension only on *devices*, *accounts*, or *browsers* that require it.
    - **Apply Usage Policies**: Use *MDM policies* to enforce *strict usage controls*, such as *disabling access* during off-hours or *limiting access* to *critical sensitive systems*.

3. **Monitor Through Alternative Means**:
    - **Endpoint Behavior Monitoring**: Deploy *endpoint detection and response (EDR)* tools (e.g., *CrowdStrike*) to flag *suspicious activities* triggered by the extension.
    - **DNS and Traffic Analysis**: Identify *unusual traffic patterns* to known *C2* or *malicious domains* and *block outbound connections*.

4. **Coordinate with the Vendor**:
    - Notify the vendor of the *vulnerability* immediately and request:
        - *Root cause analysis*.
        - *Updates* or *patches* to the extension.
        - *Specific mitigation steps* for customers.

5. **Containment and Removal**:
    - If the vulnerability poses a *severe threat*:
        - *Revoke* the extension’s access via *MDM policies*.
        - Implement *emergency procedures* to *uninstall* the extension across all endpoints.
        - Use *MDM* to enforce the use of a *secure alternative tool*.

> **Key Consideration**: Vendor transparency is critical when logs are unavailable.

## Long-Term Recommendations

To prevent future incidents, organizations should:

- **Adopt Browser Management Tools**: Use *Chrome Browser Cloud Management (CBCM)* or similar tools to enforce *strict security policies* and gain *visibility* into browser-related risks.
- **Integrate MDM Logs with SIEM**: Leverage *third-party integrations* or *proxy-based monitoring* to collect *relevant telemetry* and address *blind spots*.
- **Vendor Management Program**: Regularly review *third-party tools* for vulnerabilities. Enforce *contractual agreements* mandating compliance with *security best practices* and *prompt remediation* of issues.
- **Simulate Extension Attacks**: Conduct *red-team exercises* focusing on *malicious browser extensions* to test *organizational response plans*.
- **Alternative Solutions**: If the *third-party vendor* fails to address concerns, explore *secure alternatives* vetted through *rigorous testing* and *analysis*.

> **Key Insight**: Proactive management, user education, and vendor collaboration mitigate risks from third-party extensions.

## References
- [Cyberhaven Engineering Blog: Preliminary Analysis](https://www.cyberhaven.com/engineering-blog/cyberhavens-preliminary-analysis-of-the-recent-malicious-chrome-extension)
- [X Post by cstanley](https://x.com/cstanley/status/1872365853318225931?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1872365853318225931%7Ctwgr%5E099ab0895374dd9ccc104491a5945a5ac3385b0c%7Ctwcon%5Es1_&ref_url=https%3A%2F%2Fwww.vulnu.com%2Fp%2Fbreaking-cyberhaven-chrome-extension-compromised)
- [The Record: Cyberhaven Hack](https://therecord.media/cyberhaven-hack-google-chrome-extension)
- [The Hacker News: 16 Chrome Extensions Hacked](https://thehackernews.com/2024/12/16-chrome-extensions-hacked-exposing.html)