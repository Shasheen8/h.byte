---
title: How can one exploit a CORS policy?
date: Tue, 13 Sep 2022 16:02:00 +0000
---

**Cross-Origin Resource Sharing (CORS)** is a *browser mechanism* that extends the *Same-Origin Policy (SOP)*, allowing *content delivery networks* to instruct browsers to treat requests from *nominated domains* as *secure* and access *cross-domain resources*. However, a *weak CORS policy* can expose applications to *vulnerabilities* such as *Cross-Site Scripting (XSS)* and other attacks. This post explores the *Same-Origin Policy*, how *CORS* can be exploited, and best practices to prevent *CORS-related attacks*.

## What is the Same-Origin Policy?

The *Same-Origin Policy (SOP)* is a *web browser security mechanism* that restricts *scripts* on one *origin* from accessing *data* from another *origin*, preventing websites from attacking each other. An *origin* is defined by:

- *Protocol* (e.g., *HTTP*).
- *Domain* (e.g., `example.com`).
- *Port* (e.g., `80`).

### Key Functions of SOP
- Limits *JavaScript* access to *cross-domain content*, preventing scripts from reading *resources* on other domains.
- Allows loading *external resources* (e.g., *images*, *videos*) but restricts *script-based access* to their contents.
- Includes *cookies* and *authentication session cookies* in *cross-origin HTTP requests*, sending them with the request and receiving *user-specific data* in the response.

### Importance
Without *SOP*, a *malicious website* could access *private data* (e.g., *emails*, *messages*) from another domain within a user’s session, leading to severe *security breaches*. However, *SOP* alone does not protect against *Cross-Site Request Forgery (CSRF)* attacks, where *CORS* plays a role but isn’t a complete safeguard.

> **Key Risk**: Without *SOP*, *malicious scripts* could steal *sensitive data* across domains, compromising user privacy.

## How Can CORS Be Exploited?

A *misconfigured CORS policy* can enable attackers to exploit *cross-origin requests*, accessing *sensitive information* or compromising applications. Common *exploitation methods* include:

- **Allowing All Domains**:
    - Many applications permit *cross-origin requests* from *any domain* due to the difficulty of maintaining an *allow list*.
    - *Session cookies* are included in *cross-origin requests*, allowing *malicious domains* to access *resources* and *sensitive data* if the application reflects *arbitrary origins*.
- **Subdomain Vulnerabilities**:
    - Allowing access to all *subdomains* can grant unintended access to *external alternate domains*.
    - Example:
        - Normal domain: `healthybyte.net`
        - Alternate domain: `healthybyte.evil.net`
- **Whitelisting Null Values**:
    - Attackers can trick browsers into generating *cross-origin requests* with a `null` value in the *Origin header*, bypassing restrictions.
- **Exploiting XSS**:
    - If a *trusted source origin* is vulnerable to *XSS*, attackers can inject *malicious JavaScript* to use *CORS* and retrieve *sensitive data*.
- **Man-in-the-Middle (MITM) Attacks**:
    - A *misconfigured CORS policy* enables attackers to *intercept user traffic*, compromising the *application* and *user data*.

> **Key Vulnerability**: *Misconfigured CORS policies* can expose *sensitive resources* to *malicious domains*, enabling data theft.

## Preventing CORS Attacks

The primary source of *CORS vulnerabilities* is *misconfiguration*. Proper *CORS configurations* can mitigate these risks effectively. Best practices include:

- **Proper Configuration of Cross-Origin Requests**:
    - Set the `Access-Control-Allow-Origin` header to *specific receiver origins* rather than allowing *arbitrary domains*.
    - Example: Specify `https://healthybyte.net` instead of a wildcard.
- **Allow Only Trusted Websites**:
    - Maintain an *allow list* of *trusted origins* to prevent *cross-origin requests* from *unvalidated domains*.
- **Avoid Null Header Values**:
    - Do not allow the `Access-Control-Allow-Origin` header to accept `null`, as it can be exploited by attackers.
- **Avoid Wildcards for Internal Networks**:
    - Refrain from using wildcards (`*`) in *internal network* configurations, as they may permit access from *untrusted external domains*.
- **Supplement Browser Security**:
    - Use *CORS* as part of *browser security* but do not rely on it as the sole *protection mechanism*. Combine with other defenses (e.g., *CSRF tokens*, *content security policies*).

> **Key Strategy**: Precise *CORS configurations* and *trusted origin allow-listing* are critical to preventing *exploitation*.

## CORS Security Best Practices

The following table summarizes key *CORS security practices*:

| Practice             | Description                                                     |
|----------------------|-----------------------------------------------------------------|
| *Specific Origins*   | Set `Access-Control-Allow-Origin` to *trusted domains* only.    |
| *Trusted Allow-List* | Maintain a list of *validated origins* for access.              |
| *Avoid Null Values*  | Prevent `null` in `Access-Control-Allow-Origin` header.         |
| *No Wildcards*       | Avoid `*` for *internal networks* to block *untrusted domains*. |
| *Combined Defenses*  | Use *CORS* with *CSRF tokens* and other *security mechanisms*.  |

## Conclusion

**Cross-Origin Resource Sharing (CORS)** extends the *Same-Origin Policy (SOP)*, enabling *secure access* to *cross-domain resources* while maintaining *browser security*. The *SOP* prevents *malicious scripts* from accessing *sensitive data* across domains, but *CORS misconfigurations* can expose applications to *XSS*, *CSRF*, and *MITM attacks*. By implementing *specific origin configurations*, *trusted allow-lists*, and avoiding *null values* or *wildcards*, organizations can mitigate *CORS vulnerabilities*. However, *CORS* should be part of a broader *security strategy*, complemented by other defenses to ensure robust protection.

> **Final Takeaway**: A well-configured *CORS policy* strengthens *web security*, but reliance on *CORS* alone leaves applications vulnerable to *sophisticated attacks*.
